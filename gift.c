/*
 * ========================================================================
 *
 *       Filename:  gift.c
 *
 *    Description:
 *
 *        Version:  1.0
 *        Created:  2012年10月20日 11时11分43秒
 *       Revision:  none
 *       Compiler:  sdcc
 *
 *         Author:  Andy Scout (), andyhuzhill@gmail.com
 *   Organization:
 *
 * ========================================================================
 */
#include <8051.h>

typedef unsigned char uchar;

// 定义 STC11F04 I/O 口配置寄存器
__sbit __at(0x91) P1M1;
__sbit __at(0x92) P1M0;
__sbit __at(0xb1) P3M1;
__sbit __at(0xb2) P3M0;

// 时钟分频寄存器
__sbit __at(0x97) CLK_DIV;

// 内部拓展RAM 寄存器
__sbit __at(0x8e) AUXR;

// 定义要显示的字符串
const char *birthday = " HAPPY BIRTHDAY TO YOU GEORGIANA CHAIN SAIYA G ";
const char *greet = "MAY THE JOY AND HAPPINESS AROUND YOU TODAY AND ALWAYS  ";

// 定义26个大写字母的字模
uchar __code zimu[][8] =
{
    {0x00, 0x00, 0xFC, 0x22, 0x22, 0xFC, 0x00, 0x00}, /*"A",0*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x92, 0x92, 0x6C, 0x00, 0x00}, /*"B",1*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x7C, 0x82, 0x82, 0x44, 0x00, 0x00}, /*"C",2*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x82, 0x82, 0x7C, 0x00, 0x00}, /*"D",3*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x92, 0x92, 0x82, 0x00, 0x00}, /*"E",4*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x12, 0x12, 0x02, 0x00, 0x00}, /*"F",5*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x7C, 0x82, 0x92, 0x74, 0x00, 0x00}, /*"G",6*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x10, 0x10, 0xFE, 0x00, 0x00}, /*"H",7*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x82, 0xFE, 0x82, 0x00, 0x00, 0x00}, /*"I",8*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x60, 0x80, 0x80, 0x7E, 0x00, 0x00}, /*"J",9*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x10, 0x28, 0xC6, 0x00, 0x00}, /*"K",10*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x80, 0x80, 0x80, 0x00, 0x00}, /*"L",11*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x0C, 0x0C, 0xFE, 0x00, 0x00}, /*"M",12*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x0C, 0x30, 0xFE, 0x00, 0x00}, /*"N",13*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x7C, 0x82, 0x82, 0x7C, 0x00, 0x00}, /*"O",14*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x12, 0x12, 0x0C, 0x00, 0x00}, /*"P",15*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x7C, 0xA2, 0xC2, 0xFC, 0x00, 0x00}, /*"Q",16*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x32, 0x52, 0x8C, 0x00, 0x00}, /*"R",17*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x4C, 0x92, 0x92, 0x64, 0x00, 0x00}, /*"S",18*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x02, 0x02, 0xFE, 0x02, 0x02, 0x00}, /*"T",19*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x7E, 0x80, 0x80, 0x7E, 0x00, 0x00}, /*"U",20*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x1E, 0xE0, 0xE0, 0x1E, 0x00, 0x00}, /*"V",21*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xFE, 0x60, 0x60, 0xFE, 0x00, 0x00}, /*"W",22*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xC6, 0x38, 0x38, 0xC6, 0x00, 0x00}, /*"X",23*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x06, 0x08, 0xF0, 0x08, 0x06, 0x00, 0x00}, /*"Y",24*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0xC2, 0xB2, 0x9A, 0x86, 0x00, 0x00}, /*"Z",25*/
    /* (8 X 8 , Terminal ) */
    {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, /*" " 26*/
    {0x1e, 0x21, 0x41, 0x82, 0x82, 0x41, 0x21, 0x1e}, /*"心"  27*/
    {0xff, 0x89, 0xf5, 0x91, 0x91, 0xf5, 0x89, 0xff}, /* "囧“ 28 */
    {0x3e, 0x41, 0x95, 0xa1, 0xa1, 0x95, 0x41, 0x3e}, /* simile 29 */
};

uchar __code animation[][8] =
{
    {0x00, 0x00, 0x9e, 0x92, 0x92, 0x62, 0x00, 0x00}, /* 5 */
    {0x00, 0x00, 0x9e, 0x92, 0x92, 0x62, 0x00, 0x00}, /* 5 */
    {0x00, 0x00, 0x30, 0x28, 0x24, 0xfe, 0x20, 0x00}, /* 4 */
    {0x00, 0x00, 0x30, 0x28, 0x24, 0xfe, 0x20, 0x00}, /* 4 */
    {0x00, 0x00, 0x44, 0x92, 0x92, 0x6c, 0x00, 0x00}, /* 3 */
    {0x00, 0x00, 0x44, 0x92, 0x92, 0x6c, 0x00, 0x00}, /* 3 */
    {0x00, 0x00, 0x44, 0x62, 0x52, 0x4c, 0x00, 0x00}, /* 2 */
    {0x00, 0x00, 0x44, 0x62, 0x52, 0x4c, 0x00, 0x00}, /* 2 */
    {0x00, 0x00, 0x86, 0xff, 0xff, 0x80, 0x00, 0x00}, /* 1 */
    {0x00, 0x00, 0x86, 0xff, 0xff, 0x80, 0x00, 0x00}, /* 1 */
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00},
    {0x00, 0x00, 0x3c, 0x3c, 0x3c, 0x3c, 0x00, 0x00},
    {0x00, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0x00},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0x00, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0x7e, 0x00},
    {0x00, 0x00, 0x3c, 0x3c, 0x3c, 0x3c, 0x00, 0x00},
    {0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00},
    {0x08, 0x04, 0x42, 0x40, 0x40, 0x42, 0x04, 0x08},
    {0x04, 0x0e, 0x44, 0x40, 0x40, 0x44, 0x0e, 0x04}, /* ku */
    {0x04, 0x06, 0x40, 0x40, 0x40, 0x40, 0x06, 0x04},
    {0x04, 0x0c, 0x44, 0x40, 0x40, 0x44, 0x0c, 0x04},
    {0x04, 0x08, 0x44, 0x40, 0x40, 0x44, 0x08, 0x04},
    {0x04, 0x04, 0x44, 0x40, 0x40, 0x44, 0x04, 0x04},
    {0x04, 0x02, 0x44, 0x40, 0x40, 0x44, 0x02, 0x04}, /* xiao */
    {0x04, 0x02, 0x24, 0x40, 0x40, 0x24, 0x02, 0x04},
    {0x24, 0x4a, 0x8a, 0x80, 0x80, 0x8a, 0x4a, 0x24},
    {0x24, 0x42, 0x8a, 0x80, 0x80, 0x8a, 0x42, 0x24},
    {0x24, 0x42, 0x82, 0x80, 0x80, 0x82, 0x42, 0x24},
    {0x04, 0xf2, 0x11, 0x10, 0x10, 0xf1, 0x02, 0x04}, /*jiong */
    {0x04, 0x02, 0xf1, 0x10, 0x10, 0x11, 0xf2, 0x04},
    {0x04, 0x02, 0xf1, 0x10, 0x10, 0xf1, 0x02, 0x04},
    {0x01, 0x02, 0xf4, 0x10, 0x10, 0xf4, 0x02, 0x01},
    {0x04, 0x02, 0xf1, 0x10, 0x10, 0xf1, 0x02, 0x04},
    {0x01, 0x02, 0xf4, 0x10, 0x10, 0xf4, 0x02, 0x01},
    {0x08, 0x04, 0xe2, 0x20, 0x20, 0xe2, 0x04, 0x08},
    {0x10, 0x08, 0xc4, 0x40, 0x40, 0xc4, 0x08, 0x10},
    {0xd0, 0xc8, 0xc4, 0xc0, 0xc0, 0xc4, 0xc8, 0xd0},
    {0xf0, 0xe8, 0xe4, 0xe0, 0xe0, 0xe4, 0xe8, 0xf0},
    {0xf0, 0xf8, 0xf4, 0xf0, 0xf0, 0xf4, 0xf8, 0xf0},
    {0xf8, 0xf8, 0xfc, 0xf8, 0xf8, 0xfc, 0xf8, 0xf8},
    {0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc, 0xfc},
    {0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe, 0xfe},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0x00, 0x20, 0x44, 0x40, 0x40, 0x40, 0x24, 0x00},
    {0x00, 0x24, 0x40, 0x40, 0x40, 0x44, 0x20, 0x00},
    {0x00, 0x20, 0x44, 0x40, 0x40, 0x40, 0x24, 0x00},
    {0x00, 0x24, 0x40, 0x40, 0x40, 0x44, 0x20, 0x00},
    {0x00, 0x20, 0x44, 0x40, 0x40, 0x44, 0x20, 0x00},
    {0xa0, 0x57, 0x3f, 0xD7, 0x08, 0x60, 0x60,},
    {0x20, 0x17, 0xff, 0xd7, 0x08, 0x60, 0x60,},
    {0x20, 0x17, 0xff, 0x57, 0x88, 0x60, 0x60,},
    {0x20, 0x17, 0xff, 0x37, 0x48, 0x40, 0x30, 0x30},
    {0x08, 0x17, 0xff, 0x37, 0x50, 0x50, 0x00, 0x18},
    {0x18, 0x3c, 0x78, 0x3c, 0x18, 0x00, 0x00, 0x00}, /* heart */
    {0x00, 0x18, 0x3c, 0x78, 0x3c, 0x18, 0x00, 0x00},
    {0x00, 0x00, 0x18, 0x3c, 0x78, 0x3c, 0x18, 0x00},
    {0x00, 0x00, 0x0c, 0x1e, 0x3c, 0x1e, 0x0c, 0x00},
    {0x00, 0x0c, 0x1e, 0x3c, 0x1e, 0x0c, 0x00, 0x00},
    {0x0c, 0x1e, 0x3c, 0x1e, 0x0c, 0x00, 0x00, 0x00},
    {0x0c, 0x12, 0x0c},
    {0x18, 0x24, 0x18},
    {0x30, 0x48, 0x30},
    {0x60, 0x90, 0x60},
    {0x60, 0x90, 0x60, 0x04, 0x18, 0x04, 0x04},
    {0x60, 0x90, 0x60, 0x08, 0x30, 0x08, 0x08},
    {0x60, 0x90, 0x60, 0x20, 0xc0, 0x20},
    {0x60, 0x90, 0x60, 0x20, 0xc0, 0x2d, 0x0b, 0x09},
    {0x60, 0x90, 0x60, 0x20, 0xc0, 0x3a, 0x16, 0x12},
    {0x60, 0x90, 0x60, 0x20, 0xd0, 0x68, 0x58, 0x48},
    {0x60, 0x90, 0x60, 0xc0, 0x20, 0xd0, 0xb0, 0x90},
    {0x60, 0x90, 0x60, 0xc0, 0x20, 0xa0, 0xe0, 0x80},
    {0x30, 0x48, 0x30, 0xe0, 0x10, 0xa0, 0xc0, 0x80},
    {0x60, 0x90, 0x60, 0xc0, 0x20, 0xa0, 0xe0, 0x80},
    {0x30, 0x48, 0x30, 0xe0, 0x10, 0xa0, 0xc0, 0x80},
    {0x60, 0x90, 0x60, 0xc0, 0x20, 0xa0, 0xe0, 0x80},
    {0x30, 0x48, 0x30, 0xe0, 0x10, 0xa0, 0xc0, 0x80},
    {0x60, 0x90, 0x60, 0xc0, 0x20, 0xa0, 0xe0, 0x80},
    {0xff, },
    {0xff, 0xff,},
    {0xff, 0xff, 0xff},
    {0xff, 0xff, 0xff, 0xff,},
    {0xff, 0xff, 0xff, 0xff, 0xff},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x04 ,0x06, 0x3f, 0x08, 0x08, 0x3e, },
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x04 ,0x06, 0x3f, 0x08, 0x08, 0x3e, },
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x04 ,0x06, 0x3f, 0x08, 0x08, 0x3e, },
    {0x00, 0x28, 0x10, 0x10, 0x10, 0x28, },
    {0x00, 0x28, 0x10, 0x10, 0x10, 0x28, },
    {0x08, 0x14, 0x22, 0x2a, 0x22, 0x14, 0x08},
    {0x08, 0x14, 0x22, 0x2a, 0x22, 0x14, 0x08},
    {0x00, 0x00, 0x18, 0x3c, 0x78, 0x3c, 0x18}, /* heart */
    {0x0c, 0x3f, 0x3f, 0xfc, 0xfc, 0x3f, 0x3f, 0x0c},
    {0x00, 0x00, 0x18, 0x3c, 0x78, 0x3c, 0x18}, /* heart */
    {0x0c, 0x3f, 0x3f, 0xfc, 0xfc, 0x3f, 0x3f, 0x0c},
    {0x04, 0x02, 0x24, 0x40, 0x40, 0x24, 0x02, 0x04},/* simile */
    {0x04, 0x02, 0x24, 0x40, 0x40, 0x24, 0x02, 0x04},/* simile */
    {0x24, 0x16, 0x0f, 0x38, 0x28, 0x18, 0x24, 0x02}, /* dog */
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x24, 0x16, 0x0f, 0x38, 0x28, 0x18, 0x24, 0x02}, /* dog */
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x24, 0x16, 0x0f, 0x38, 0x28, 0x18, 0x24, 0x02}, /* dog */
    {0x04, 0x06, 0x3f, 0x08, 0x08, 0x38, 0x04, 0x02},/* dog */
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x04, }, /*man*/
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x0f, },
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x08, 0x04, 0x02},
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x08, 0x08, 0x08},
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x10, 0x20, 0x40},
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x08, 0x08, 0x08},
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x08, 0x04, 0x02},
    {0x90, 0x4b, 0x3f, 0x4b, 0x88, 0x0f, },
    {0x04, 0x26, 0x1f, 0x08, 0x28, 0x1a, 0x04,},/* dog */
    {0x04, 0x26, 0x1f, 0x08, 0x28, 0x1a, 0x04,},/* dog */
    {0x04, 0x26, 0x1f, 0x08, 0x28, 0x1a, 0x04,},/* dog */
    {0x02, 0x24, 0x18, 0x28, 0x38, 0x0f, 0x16, 0x24},
    {0x08, 0x08, 0x38, 0x08, 0x08, 0x3f, 0x06, 0x04},
    {0x08, 0x28, 0x18, 0x28, 0x38, 0x0f, 0x16, 0x24},
    {0x08, 0x08, 0x38, 0x08, 0x08, 0x3f, 0x06, 0x04},
    {0x08, 0x28, 0x18, 0x28, 0x38, 0x0f, 0x16, 0x24},
    {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01},
    {0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03},
    {0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07},
    {0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f},
    {0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f},
    {0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f, 0x3f},
    {0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f, 0x7f},
    {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff},
    {0x08, 0x84, 0x96, 0x95, 0xfe, 0x94, 0x94, 0x84}, /* 生 */
    {0x00, 0xff, 0x49, 0x49, 0x49, 0x49, 0xff, 0x00}, /* 日 */
    {0x04, 0xff, 0x84, 0x6a, 0x1f, 0x2a, 0x4e, 0x88}, /* 快 */
    {0x48, 0x2e, 0x1a, 0x4a, 0xfe, 0x1a, 0x29, 0x48}, /* 乐 */
};


void delay(uchar);

/*
 * 函数功能：输出一个字母
 * 参数：dat 字母的字
 *       repeat 表示是否和上个要输出的字母重复
 */
void
character(const char * dat, uchar repeat)
{
    uchar i;
    P1 = 0x7f;
    for (i = 0; i < 8 ; i++)
    {
        if (repeat)
        {
            P3 = *dat++;
            repeat = 0;
        }               //如果有重复，则输出的字模向左移一位
        P3 = *dat++;
        delay(100);
        P3 = 0x00;
        __asm
        mov a, _P1
        rr a
        mov _P1, a
        __endasm;       //循环左移P3，扫描8x8点阵
    }
}

/* 函数功能： 延时 */

void
delay(uchar t)
{
    uchar x, y;
    for (x = 0; x < t; x++)
        for (y = 0; y < 15; y++);
}

/*
 * 函数功能：输出一个字符串，目前字符串中只允许有大写英文字母和空格
 * 参数：  *str 字符串地址
 *
 */
void
print(const char * str)
{
    uchar i;
    char last = 0;
    uchar repeat;
    while (*str)
    {
        if (last == *str)
            repeat = 1;
        else
            repeat = 0;
        for (i = 0; i < 40; i++)
            if ( *str != ' ' )
                character(zimu[*str - 0x41], repeat);  //输出字母
            else
                character(zimu[26], repeat);           //输出空格
        P1 = 0x00;
        P3 = 0x00;
        delay(10);
        last = *str;
        str++;
    }
}

/*
 * 函数功能：初始化配置
 *
 */
void
init_config(void)
{
    P3M0 = 0xff;
    P3M1 = 0x00; // P3各个端口设为强推挽输出
    P3 = 0x00;
    P1M0 = 0xff;
    P1M1 = 0x00; // P1 各个端口设为强推挽输出
    P1 = 0x00;;
    AUXR = 0x00;
}

void ani(void)
{
    uchar cnt;
    uchar i;
    for( cnt = 0  ; cnt < 135 ; cnt++ )
    {
        for( i = 0 ; i < 20  ; i++ )
        {
            character(animation[cnt], 0);
        }
        delay(50);
    }
}

/*
 * 主函数
 */

void
main(void)
{
    long cnt = 0;
    int i;
    init_config();
    while (1)
    {
        cnt++;
        ani();
        print(birthday);
        delay(250);
        for( i = 0 ; i < 240 ; i++ )
            character(zimu[29], 0);
        print(greet);
        delay(250);
        for( i = 0 ; i < 240 ; i++ )
            character(zimu[29], 0);
        delay(250);
        if(100 == cnt)
        {
            print(" NICE TO MEET YOU  ");
            cnt = 0;
            delay(25);
        }
        if (10 == cnt)
        {
            print("THE LAZY BROWN FOX JUMPS OVER THE LAZY DOG");
            for( i = 0  ; i < 240 ; i++ )
                character(zimu[28], 0);
        }
        if (30 == cnt)
        {
            print("LET IT BE ");
            for( i = 0 ; i < 240 ; i++ )
                character(zimu[27], 0);
        }
        if (501 == cnt)
            cnt = 0;
    }
}
